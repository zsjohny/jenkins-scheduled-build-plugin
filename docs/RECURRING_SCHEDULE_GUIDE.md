# 周期性发布功能使用指南

## 概述

周期性发布功能允许您为Jenkins任务设置自动重复执行的构建规则。系统会根据您设置的规则自动生成预约任务，无需手动添加。

## 功能特性

### ✅ 支持的调度类型

1. **每天执行** - 每天在固定时间自动执行构建
2. **每周执行** - 每周特定几天在固定时间执行构建
3. **每月执行** - 每月特定几号在固定时间执行构建
4. **Cron表达式** - 使用Cron表达式定义复杂的执行规则（待完善）

### 🔄 自动化工作流

- 系统每小时自动检查周期性规则
- 自动为启用的规则生成新的预约任务
- 自动执行到期的预约任务
- 支持启用/禁用规则，无需删除

## 使用方法

### 1. 访问预约构建页面

在Jenkins任务页面左侧菜单中，点击"预约构建"链接。

### 2. 添加周期性规则

在"🔄 添加周期性规则"卡片中：

#### 每天执行
1. 选择"每天"选项卡
2. 输入执行时间（格式：HH:mm，例如 09:00）
3. 可选：添加描述说明
4. 可选：配置构建参数
5. 点击"✓ 添加周期性规则"

#### 每周执行
1. 选择"每周"选项卡
2. 点击选择要执行的星期几（可多选）
3. 输入执行时间（格式：HH:mm）
4. 可选：添加描述说明
5. 可选：配置构建参数
6. 点击"✓ 添加周期性规则"

#### 每月执行
1. 选择"每月"选项卡
2. 输入要执行的日期，多个日期用逗号分隔（例如：1,15,28）
3. 输入执行时间（格式：HH:mm）
4. 可选：添加描述说明
5. 可选：配置构建参数
6. 点击"✓ 添加周期性规则"

### 3. 管理周期性规则

在"🔄 周期性规则"列表中，您可以：

- **查看规则详情** - 显示调度类型、执行时间、参数等信息
- **启用/禁用规则** - 点击"⏸️ 禁用"或"▶️ 启用"按钮
  - 禁用后系统将不再为该规则生成新任务
  - 已生成的待执行任务会被取消
- **删除规则** - 点击"🗑️ 删除"按钮永久删除规则

### 4. 查看生成的预约任务

周期性规则生成的预约任务会显示在"🚀 待执行的预约"列表中，描述中会标注"[周期性]"字样。

## 使用示例

### 示例1：每天早上9点执行构建

```
调度类型：每天
执行时间：09:00
描述：每日构建
```

### 示例2：每周一、三、五下午5点执行

```
调度类型：每周
选择星期：周一、周三、周五
执行时间：17:00
描述：工作日构建
```

### 示例3：每月1号和15号凌晨2点执行

```
调度类型：每月
日期：1,15
执行时间：02:00
描述：月度定期构建
```

## 与单次预约的区别

| 特性 | 单次预约 | 周期性规则 |
|------|---------|-----------|
| 执行次数 | 仅一次 | 自动重复 |
| 手动操作 | 需要每次手动添加 | 设置一次，自动生成 |
| 管理方式 | 执行后删除 | 可启用/禁用 |
| 适用场景 | 临时、特殊需求 | 定期、重复任务 |

## 技术细节

### 任务生成机制

1. 系统每小时检查一次所有启用的周期性规则
2. 为每个规则计算下一次执行时间
3. 如果该时间点还没有生成任务，则自动创建预约任务
4. 任务会关联到对应的周期性规则，标记来源

### 时区处理

所有时间均使用Jenkins服务器的系统时区。

### 生效规则

- 新添加的规则会立即生效，系统会为其生成第一个预约任务
- 禁用的规则不会生成新任务，已生成的待执行任务会被取消
- 删除规则后，已生成的待执行任务会被取消

## 注意事项

1. **时间格式** - 请使用24小时制（HH:mm），例如 09:00、17:30
2. **日期有效性** - 每月执行时，如果某个月没有指定的日期（如2月30日），该月会跳过
3. **参数配置** - 周期性规则的参数会应用到所有生成的预约任务
4. **权限要求** - 需要有任务的BUILD权限才能添加/管理周期性规则
5. **性能考虑** - 建议合理设置规则数量，避免过多规则影响系统性能

## 常见问题

### Q: 如何修改已有的周期性规则？
A: 目前需要删除旧规则，然后添加新规则。后续版本会增加编辑功能。

### Q: 禁用规则后，已生成的任务会怎样？
A: 已生成的待执行任务会被自动取消。

### Q: 周期性规则生成的任务可以手动取消吗？
A: 可以。在"待执行的预约"列表中点击"✗ 取消"按钮即可。

### Q: 系统重启后周期性规则还有效吗？
A: 是的。所有规则都会持久化保存，Jenkins重启后会自动恢复。

### Q: 可以为同一个任务设置多条周期性规则吗？
A: 完全可以！这正是此功能的核心优势。您可以设置任意多条规则，例如同时设置每天构建和每周五发布。

## 最佳实践

1. **合理命名** - 为每条规则添加清晰的描述，方便后续管理
2. **错峰执行** - 避免所有规则在同一时间点执行，分散系统负载
3. **定期清理** - 定期检查和清理不再需要的规则
4. **先测试** - 新规则建议先设置为每小时执行测试，确认无误后再调整为实际周期
5. **备份配置** - 重要规则建议记录配置，便于恢复

## 版本历史

- v1.1.0 - 新增周期性发布功能，支持每天、每周、每月调度
- v1.0.0 - 基础的单次预约功能

## 技术支持

如有问题或建议，请提交Issue到项目仓库。

