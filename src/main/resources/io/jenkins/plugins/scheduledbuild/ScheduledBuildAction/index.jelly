<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:l="/lib/layout" xmlns:f="/lib/form">
    <l:layout title="é¢„çº¦æ„å»º - ${it.job.displayName}" permission="${it.job.READ}">
        <st:include page="sidepanel.jelly" it="${it.job}"/>
        <l:main-panel>
            <style>
                .scheduled-build-container {
                    max-width: 1200px;
                }
                .scheduled-build-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 8px;
                    margin-bottom: 30px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                }
                .scheduled-build-header h1 {
                    margin: 0;
                    color: white;
                    font-size: 28px;
                    font-weight: 600;
                }
                .add-schedule-card {
                    background: white;
                    padding: 25px;
                    margin-bottom: 30px;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    border: 1px solid #e0e0e0;
                }
                .add-schedule-card h2 {
                    margin-top: 0;
                    color: #333;
                    font-size: 20px;
                    font-weight: 600;
                    border-bottom: 2px solid #667eea;
                    padding-bottom: 10px;
                    margin-bottom: 20px;
                }
                .form-row {
                    margin-bottom: 20px;
                }
                .form-label {
                    display: block;
                    font-weight: 600;
                    color: #555;
                    margin-bottom: 8px;
                    font-size: 14px;
                }
                /* ä¿æŒ Jenkins åŸç”Ÿæ ·å¼ï¼Œåªæ·»åŠ å¿…è¦çš„è‡ªå®šä¹‰æ ·å¼ */
                .scheduled-build-container .form-section {
                    margin-top: 20px;
                }
                
                /* ç¡®ä¿å‚æ•°éƒ¨åˆ†æœ‰é€‚å½“çš„é—´è· */
                .scheduled-build-container .form-section h3 {
                    margin-top: 0;
                    margin-bottom: 15px;
                    color: #333;
                    font-size: 16px;
                    font-weight: 600;
                }
                
                /* å‚æ•°æ ‡ç­¾æ ·å¼ */
                .scheduled-build-container .form-label {
                    font-weight: bold !important;
                    color: #333 !important;
                    font-size: 14px !important;
                }
                
                /* å‚æ•°æè¿°æ ·å¼ */
                .scheduled-build-container .form-description {
                    color: #666 !important;
                    font-size: 12px !important;
                    font-style: italic !important;
                }
                
                /* å¿…å¡«å‚æ•°æ ·å¼ */
                .scheduled-build-container .form-label[required] {
                    color: #d73527 !important;
                }
                
                /* å‚æ•°è¾“å…¥æ¡†æ ·å¼ */
                .scheduled-build-container .form-input,
                .scheduled-build-container .form-textarea,
                .scheduled-build-container .form-select {
                    border: 1px solid #ccc !important;
                    border-radius: 4px !important;
                    padding: 8px !important;
                    font-size: 14px !important;
                }
                
                /* å‚æ•°è¾“å…¥æ¡†ç„¦ç‚¹æ ·å¼ */
                .scheduled-build-container .form-input:focus,
                .scheduled-build-container .form-textarea:focus,
                .scheduled-build-container .form-select:focus {
                    border-color: #4a90e2 !important;
                    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2) !important;
                }
                
                /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ */
                .btn-primary {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 12px 30px;
                    font-size: 15px;
                    font-weight: 600;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.3s;
                    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
                }
                .btn-primary:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
                }
                .btn-primary {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 12px 30px;
                    font-size: 15px;
                    font-weight: 600;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.3s;
                    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
                }
                .btn-primary:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
                }
                .btn-danger {
                    background: #dc3545;
                    color: white;
                    padding: 6px 14px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    transition: background 0.3s;
                }
                .btn-danger:hover {
                    background: #c82333;
                }
                .btn-secondary {
                    background: #6c757d;
                    color: white;
                    padding: 6px 14px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    transition: background 0.3s;
                }
                .btn-secondary:hover {
                    background: #5a6268;
                }
                .schedule-list-card {
                    background: white;
                    padding: 25px;
                    margin-bottom: 30px;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    border: 1px solid #e0e0e0;
                }
                .schedule-list-card h2 {
                    margin-top: 0;
                    color: #333;
                    font-size: 20px;
                    font-weight: 600;
                    margin-bottom: 20px;
                }
                .schedule-count {
                    background: #667eea;
                    color: white;
                    padding: 2px 10px;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 600;
                    margin-left: 10px;
                }
                .no-data {
                    text-align: center;
                    padding: 40px;
                    color: #999;
                    font-size: 14px;
                }
                .status-badge {
                    padding: 4px 12px;
                    border-radius: 12px;
                    font-size: 12px;
                    font-weight: 600;
                    display: inline-block;
                }
                .status-executed {
                    background: #d4edda;
                    color: #155724;
                }
                .status-cancelled {
                    background: #f8d7da;
                    color: #721c24;
                }
                .status-pending {
                    background: #d1ecf1;
                    color: #0c5460;
                }
                .status-expired {
                    background: #fff3cd;
                    color: #856404;
                }
                .countdown {
                    font-weight: 600;
                    color: #667eea;
                    font-family: 'Courier New', monospace;
                }
                .param-display {
                    background: #f8f9fa;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-family: 'Courier New', monospace;
                    font-size: 12px;
                    color: #495057;
                    border: 1px solid #e9ecef;
                }
                .checkbox-wrapper {
                    display: flex;
                    align-items: center;
                }
                .checkbox-wrapper input[type="checkbox"] {
                    width: 18px;
                    height: 18px;
                    margin-right: 8px;
                    cursor: pointer;
                }
                .schedule-type-selector {
                    display: flex;
                    gap: 10px;
                    margin-bottom: 20px;
                }
                .schedule-type-option {
                    flex: 1;
                    padding: 15px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    cursor: pointer;
                    text-align: center;
                    transition: all 0.3s;
                    background: white;
                }
                .schedule-type-option:hover {
                    border-color: #667eea;
                    background: #f8f9ff;
                }
                .schedule-type-option.active {
                    border-color: #667eea;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                }
                .schedule-type-content {
                    display: none;
                    padding: 20px;
                    background: #f8f9fa;
                    border-radius: 8px;
                    margin-top: 20px;
                }
                .schedule-type-content.active {
                    display: block;
                }
                
                /* ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™æ ·å¼ */
                .edit-schedule-type-option {
                    flex: 1;
                    text-align: center;
                    padding: 15px;
                    cursor: pointer;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    transition: all 0.3s ease;
                    background: white;
                }
                
                .edit-schedule-type-option:hover {
                    border-color: #4a90e2;
                    box-shadow: 0 4px 8px rgba(74, 144, 226, 0.1);
                }
                
                .edit-schedule-type-option.active {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border-color: #667eea;
                    box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
                }
                
                .edit-schedule-type-content {
                    display: none;
                    margin-top: 20px;
                    animation: fadeIn 0.3s ease-in;
                }
                
                .edit-schedule-type-content.active {
                    display: block;
                }
                
                .weekday-selector {
                    display: flex;
                    gap: 10px;
                    flex-wrap: wrap;
                }
                .weekday-option {
                    flex: 0 0 calc(14.28% - 10px);
                    padding: 10px;
                    border: 2px solid #e0e0e0;
                    border-radius: 6px;
                    text-align: center;
                    cursor: pointer;
                    user-select: none;
                    transition: all 0.2s;
                }
                .weekday-option:hover {
                    border-color: #667eea;
                }
                .weekday-option.selected {
                    border-color: #667eea;
                    background: #667eea;
                    color: white;
                }
                .rule-card {
                    background: #f8f9fa;
                    padding: 15px;
                    margin-bottom: 15px;
                    border-radius: 8px;
                    border-left: 4px solid #667eea;
                }
                .rule-card.disabled {
                    opacity: 0.6;
                    border-left-color: #999;
                }
                .rule-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                }
                .rule-title {
                    font-weight: 600;
                    color: #333;
                    font-size: 15px;
                }
                .rule-actions {
                    display: flex;
                    gap: 8px;
                }
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                }
                .modal-content {
                    background-color: white;
                    margin: 5% auto;
                    padding: 30px;
                    border-radius: 8px;
                    width: 80%;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                }
                .modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 2px solid #667eea;
                }
                .modal-header h2 {
                    margin: 0;
                    color: #667eea;
                }
                .close {
                    color: #aaa;
                    font-size: 28px;
                    font-weight: bold;
                    cursor: pointer;
                    line-height: 20px;
                }
                .close:hover {
                    color: #000;
                }
                .btn-edit {
                    background: #ffc107;
                    color: #333;
                    padding: 6px 14px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    transition: background 0.3s;
                    margin-right: 5px;
                }
                .btn-edit:hover {
                    background: #ffb300;
                }
            </style>
            
            <script type="text/javascript">
                // åŠ¨æ€å€’è®¡æ—¶æ›´æ–°
                function updateCountdowns() {
                    var countdowns = document.querySelectorAll('.countdown');
                    countdowns.forEach(function(elem) {
                        var targetTime = parseInt(elem.getAttribute('data-target'));
                        if (!targetTime) return;
                        
                        var now = new Date().getTime();
                        var diff = targetTime - now;
                        
                        if (diff &lt;= 0) {
                            elem.textContent = 'å³å°†æ‰§è¡Œ...';
                            elem.style.color = '#dc3545';
                            return;
                        }
                        
                        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((diff % (1000 * 60)) / 1000);
                        
                        var result = '';
                        if (days > 0) result += days + 'å¤© ';
                        if (hours > 0 || days > 0) result += hours + 'å°æ—¶ ';
                        if (minutes > 0 || hours > 0 || days > 0) result += minutes + 'åˆ† ';
                        result += seconds + 'ç§’';
                        
                        elem.textContent = result;
                        
                        // æ ¹æ®å‰©ä½™æ—¶é—´æ”¹å˜é¢œè‰²
                        if (diff &lt; 300000) { // å°äº5åˆ†é’Ÿ
                            elem.style.color = '#dc3545';
                        } else if (diff &lt; 3600000) { // å°äº1å°æ—¶
                            elem.style.color = '#fd7e14';
                        } else {
                            elem.style.color = '#667eea';
                        }
                    });
                }
                
                // å°† datetime-local è¾“å…¥è½¬æ¢ä¸º Jenkins æœŸæœ›çš„æ ¼å¼
                function setupDateTimeInput() {
                    var scheduledTimeInput = document.querySelector('input[name="scheduledTime"]');
                    if (scheduledTimeInput) {
                        // åˆ›å»º datetime-local è¾“å…¥
                        var datetimeInput = document.createElement('input');
                        datetimeInput.type = 'datetime-local';
                        datetimeInput.name = 'scheduledTime';
                        datetimeInput.required = true;
                        datetimeInput.style.width = '100%';
                        datetimeInput.style.padding = '8px';
                        datetimeInput.style.border = '1px solid #ccc';
                        datetimeInput.style.borderRadius = '4px';
                        
                        // è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´å1å°æ—¶
                        var now = new Date();
                        now.setHours(now.getHours() + 1);
                        var year = now.getFullYear();
                        var month = String(now.getMonth() + 1).padStart(2, '0');
                        var day = String(now.getDate()).padStart(2, '0');
                        var hours = String(now.getHours()).padStart(2, '0');
                        var minutes = String(now.getMinutes()).padStart(2, '0');
                        datetimeInput.value = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
                        
                        // æ›¿æ¢åŸå§‹è¾“å…¥
                        scheduledTimeInput.parentNode.replaceChild(datetimeInput, scheduledTimeInput);
                        
                        // åœ¨è¡¨å•æäº¤æ—¶è½¬æ¢æ ¼å¼
                        var form = datetimeInput.closest('form');
                        if (form) {
                            form.addEventListener('submit', function(e) {
                                var datetimeValue = datetimeInput.value;
                                if (datetimeValue) {
                                    // è½¬æ¢ä¸º Jenkins æœŸæœ›çš„æ ¼å¼ (yyyy-MM-dd'T'HH:mm)
                                    var hiddenInput = document.createElement('input');
                                    hiddenInput.type = 'hidden';
                                    hiddenInput.name = 'scheduledTime';
                                    hiddenInput.value = datetimeValue;
                                    form.appendChild(hiddenInput);
                                }
                            });
                        }
                    }
                }
                
                // åˆå§‹åŒ–å‚æ•°æ¸²æŸ“
                function initializeParameterRendering() {
                    // ç¡®ä¿ Jenkins è¡¨å•ç»„ä»¶æ­£ç¡®åˆå§‹åŒ–
                    if (typeof Behaviour !== 'undefined') {
                        Behaviour.applySubtree(document);
                    }
                    
                    // ä¸ºå‚æ•°æ·»åŠ å¿…è¦çš„æ ·å¼å’ŒåŠŸèƒ½
                    var paramEntries = document.querySelectorAll('.scheduled-build-container .form-section .form-entry');
                    paramEntries.forEach(function(entry) {
                        var title = entry.querySelector('.form-label');
                        if (title) {
                            // ç¡®ä¿æ ‡é¢˜æœ‰æ­£ç¡®çš„æ ·å¼
                            title.style.fontWeight = 'bold';
                            title.style.color = '#333';
                        }
                        
                        // ä¸ºå¿…å¡«å‚æ•°æ·»åŠ çº¢è‰²æ˜Ÿå·
                        var required = entry.querySelector('.form-label[required]');
                        if (required) {
                            var asterisk = document.createElement('span');
                            asterisk.innerHTML = ' <span style="color:red"><strong>ã€å¿…å¡«ã€‘</strong></span>';
                            required.appendChild(asterisk);
                        }
                    });
                }
                
                // å‘¨æœŸæ€§è§„åˆ™ï¼šåˆ‡æ¢è°ƒåº¦ç±»å‹
                function switchScheduleType(type) {
                    // æ›´æ–°é€‰é¡¹å¡æ ·å¼
                    document.querySelectorAll('.schedule-type-option').forEach(function(option) {
                        option.classList.remove('active');
                    });
                    document.querySelector('.schedule-type-option[data-type="' + type + '"]').classList.add('active');
                    
                    // æ›´æ–°å†…å®¹åŒºåŸŸ
                    document.querySelectorAll('.schedule-type-content').forEach(function(content) {
                        content.classList.remove('active');
                    });
                    document.getElementById('schedule-' + type.toLowerCase()).classList.add('active');
                    
                    // æ›´æ–°éšè—çš„scheduleTypeå­—æ®µ
                    document.getElementById('scheduleTypeInput').value = type;
                }
                
                // å‘¨æœŸæ€§è§„åˆ™ï¼šåˆ‡æ¢æ˜ŸæœŸé€‰æ‹©
                function toggleWeekDay(day) {
                    var option = document.querySelector('.weekday-option[data-day="' + day + '"]');
                    var checkbox = document.getElementById('weekDay' + day);
                    
                    if (option.classList.contains('selected')) {
                        option.classList.remove('selected');
                        checkbox.checked = false;
                    } else {
                        option.classList.add('selected');
                        checkbox.checked = true;
                    }
                }
                
                // ç¼–è¾‘é¢„çº¦ï¼šæ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
                function editScheduledBuild(button) {
                    var modal = document.getElementById('editModal');
                    
                    // ä» data å±æ€§è¯»å–æ•°æ®
                    var taskId = button.getAttribute('data-task-id');
                    var scheduledTime = parseInt(button.getAttribute('data-scheduled-time'));
                    var description = button.getAttribute('data-description') || '';
                    var parameters = button.getAttribute('data-parameters') || '';
                    
                    // è®¾ç½®ä»»åŠ¡ID
                    document.getElementById('editTaskId').value = taskId;
                    
                    // è½¬æ¢æ—¶é—´æˆ³ä¸º datetime-local æ ¼å¼
                    var date = new Date(scheduledTime);
                    var year = date.getFullYear();
                    var month = String(date.getMonth() + 1).padStart(2, '0');
                    var day = String(date.getDate()).padStart(2, '0');
                    var hours = String(date.getHours()).padStart(2, '0');
                    var minutes = String(date.getMinutes()).padStart(2, '0');
                    var datetimeValue = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
                    
                    document.getElementById('editScheduledTime').value = datetimeValue;
                    document.getElementById('editDescription').value = description;
                    
                    // å¡«å……å‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (parameters) {
                        var paramsObj = {};
                        try {
                            // parametersæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ¼å¼å¦‚ "key1=value1, key2=value2"
                            if (parameters !== 'æ— å‚æ•°') {
                                var pairs = parameters.split(', ');
                                pairs.forEach(function(pair) {
                                    var kv = pair.split('=');
                                    if (kv.length === 2) {
                                        paramsObj[kv[0].trim()] = kv[1].trim();
                                    }
                                });
                            }
                        } catch (e) {
                            console.error('è§£æå‚æ•°å¤±è´¥:', e);
                        }
                        
                        // å¡«å……å‚æ•°è¾“å…¥æ¡†
                        var paramInputs = document.querySelectorAll('#editParametersSection input, #editParametersSection select, #editParametersSection textarea');
                        paramInputs.forEach(function(input) {
                            var paramName = input.name.replace('param_', '');
                            if (paramsObj[paramName]) {
                                if (input.type === 'checkbox') {
                                    input.checked = (paramsObj[paramName] === 'true');
                                } else {
                                    input.value = paramsObj[paramName];
                                }
                            }
                        });
                    }
                    
                    modal.style.display = 'block';
                }
                
                // ç¼–è¾‘é¢„çº¦ï¼šå…³é—­æ¨¡æ€æ¡†
                function closeEditModal() {
                    document.getElementById('editModal').style.display = 'none';
                }
                
                // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
                window.onclick = function(event) {
                    var modal = document.getElementById('editModal');
                    if (event.target === modal) {
                        closeEditModal();
                    }
                    var recurringModal = document.getElementById('editRecurringModal');
                    if (event.target === recurringModal) {
                        closeEditRecurringModal();
                    }
                }
                
                // ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™ï¼šæ‰“å¼€æ¨¡æ€æ¡†
                function editRecurringRule(button) {
                    var modal = document.getElementById('editRecurringModal');
                    
                    // ä» data å±æ€§è¯»å–æ•°æ®
                    var ruleId = button.getAttribute('data-rule-id');
                    var scheduleType = button.getAttribute('data-schedule-type');
                    var description = button.getAttribute('data-description') || '';
                    var parameters = button.getAttribute('data-parameters') || '';
                    
                    // è®¾ç½®è§„åˆ™ID
                    document.getElementById('editRuleId').value = ruleId;
                    document.getElementById('editRuleDescription').value = description;
                    
                    // è®¾ç½®è°ƒåº¦ç±»å‹
                    document.getElementById('editScheduleTypeInput').value = scheduleType;
                    switchEditScheduleType(scheduleType);
                    
                    // TODO: å¡«å……å‚æ•°å€¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
                    
                    modal.style.display = 'block';
                }
                
                // ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™ï¼šå…³é—­æ¨¡æ€æ¡†
                function closeEditRecurringModal() {
                    document.getElementById('editRecurringModal').style.display = 'none';
                }
                
                // ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™ï¼šåˆ‡æ¢è°ƒåº¦ç±»å‹
                function switchEditScheduleType(type) {
                    // æ›´æ–°é€‰é¡¹å¡æ ·å¼
                    document.querySelectorAll('.edit-schedule-type-option').forEach(function(option) {
                        option.classList.remove('active');
                    });
                    var activeOption = document.querySelector('.edit-schedule-type-option[data-type="' + type + '"]');
                    if (activeOption) {
                        activeOption.classList.add('active');
                    }
                    
                    // æ›´æ–°å†…å®¹åŒºåŸŸ
                    document.querySelectorAll('.edit-schedule-type-content').forEach(function(content) {
                        content.classList.remove('active');
                    });
                    var activeContent = document.getElementById('edit-schedule-' + type.toLowerCase());
                    if (activeContent) {
                        activeContent.classList.add('active');
                    }
                    
                    // æ›´æ–°éšè—çš„scheduleTypeå­—æ®µ
                    document.getElementById('editScheduleTypeInput').value = type;
                }
                
                // é¡µé¢åŠ è½½åç«‹å³æ›´æ–°ä¸€æ¬¡
                window.addEventListener('DOMContentLoaded', function() {
                    updateCountdowns();
                    setupDateTimeInput();
                    initializeParameterRendering();
                    // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                    setInterval(updateCountdowns, 1000);
                    
                    // åˆå§‹åŒ–å‘¨æœŸæ€§è§„åˆ™è¡¨å•
                    var defaultType = 'DAILY';
                    if (document.getElementById('scheduleTypeInput')) {
                        switchScheduleType(defaultType);
                    }
                });
            </script>
            
            <div class="scheduled-build-container">
                <div class="scheduled-build-header">
                    <h1>â° é¢„çº¦æ„å»ºç®¡ç†</h1>
                </div>
            
            <!-- æ·»åŠ æ–°é¢„çº¦è¡¨å• -->
                <div class="add-schedule-card">
                    <h2>ğŸ“ æ·»åŠ æ–°é¢„çº¦</h2>
                    <f:form method="post" action="schedule">
                        <f:entry title="ğŸ“… é¢„çº¦æ—¶é—´" description="é€‰æ‹©æ„å»ºæ‰§è¡Œçš„æ—¥æœŸå’Œæ—¶é—´">
                            <f:textbox name="scheduledTime" 
                                       value=""
                                       checkUrl="'checkTime'"
                                       checkMethod="post"/>
                        </f:entry>
                        
                        <f:entry title="ğŸ“„ æè¿°" description="ä¸ºè¿™æ¬¡é¢„çº¦æ·»åŠ è¯´æ˜ï¼Œæ–¹ä¾¿åç»­è¯†åˆ«">
                            <f:textbox name="description" 
                                       value=""
                                       placeholder="é¢„çº¦è¯´æ˜ï¼ˆå¯é€‰ï¼‰"/>
                        </f:entry>
                        
                        <!-- å‚æ•° -->
                        <j:if test="${!it.jobParameters.isEmpty()}">
                            <f:section title="ğŸ”§ æ„å»ºå‚æ•°">
                                <j:forEach var="param" items="${it.jobParameters}">
                                    <f:entry title="${param.name}" description="${param.description}">
                                        <j:choose>
                                            <j:when test="${param.class.simpleName == 'BooleanParameterDefinition'}">
                                                <f:checkbox name="param_${param.name}" 
                                                           checked="${param.defaultParameterValue.value}"
                                                           value="true"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'ChoiceParameterDefinition'}">
                                                <f:select name="param_${param.name}">
                                                    <j:forEach var="choice" items="${param.choices}">
                                                        <f:option value="${choice}" selected="${choice == param.defaultParameterValue.value}">${choice}</f:option>
                                                    </j:forEach>
                                                </f:select>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'TextParameterDefinition'}">
                                                <f:textarea name="param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"
                                                           rows="3"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'PasswordParameterDefinition'}">
                                                <f:password name="param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"/>
                                            </j:when>
                                            <j:otherwise>
                                                <f:textbox name="param_${param.name}" 
                                                          value="${param.defaultParameterValue.value}"/>
                                            </j:otherwise>
                                        </j:choose>
                                    </f:entry>
                                </j:forEach>
                            </f:section>
                        </j:if>
                        
                        <f:block>
                            <f:submit value="âœ“ æ·»åŠ é¢„çº¦" class="btn-primary"/>
                        </f:block>
                    </f:form>
                </div>

            <!-- æ·»åŠ å‘¨æœŸæ€§è§„åˆ™ -->
                <div class="add-schedule-card">
                    <h2>ğŸ”„ æ·»åŠ å‘¨æœŸæ€§è§„åˆ™</h2>
                    <p style="color: #666; margin-bottom: 20px;">è®¾ç½®è‡ªåŠ¨é‡å¤æ‰§è¡Œçš„æ„å»ºä»»åŠ¡ï¼Œç³»ç»Ÿä¼šæ ¹æ®è§„åˆ™è‡ªåŠ¨ç”Ÿæˆé¢„çº¦</p>
                    
                    <f:form method="post" action="addRecurringRule">
                        <input type="hidden" id="scheduleTypeInput" name="scheduleType" value="DAILY"/>
                        
                        <!-- è°ƒåº¦ç±»å‹é€‰æ‹©å™¨ -->
                        <div class="schedule-type-selector">
                            <div class="schedule-type-option active" data-type="DAILY" onclick="switchScheduleType('DAILY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“…</div>
                                <div style="font-weight: 600;">æ¯å¤©</div>
                                <div style="font-size: 12px; color: #666;">æ¯å¤©å›ºå®šæ—¶é—´æ‰§è¡Œ</div>
                            </div>
                            <div class="schedule-type-option" data-type="WEEKLY" onclick="switchScheduleType('WEEKLY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“†</div>
                                <div style="font-weight: 600;">æ¯å‘¨</div>
                                <div style="font-size: 12px; color: #666;">æ¯å‘¨ç‰¹å®šå‡ å¤©æ‰§è¡Œ</div>
                            </div>
                            <div class="schedule-type-option" data-type="MONTHLY" onclick="switchScheduleType('MONTHLY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ—“ï¸</div>
                                <div style="font-weight: 600;">æ¯æœˆ</div>
                                <div style="font-size: 12px; color: #666;">æ¯æœˆç‰¹å®šå‡ å·æ‰§è¡Œ</div>
                            </div>
                        </div>
                        
                        <!-- æ¯å¤©é…ç½® -->
                        <div id="schedule-daily" class="schedule-type-content active">
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´" description="é€‰æ‹©æ¯å¤©æ‰§è¡Œçš„æ—¶é—´">
                                <f:textbox name="dailyTime" 
                                          value="09:00"
                                          placeholder="ä¾‹å¦‚: 09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- æ¯å‘¨é…ç½® -->
                        <div id="schedule-weekly" class="schedule-type-content">
                            <f:entry title="ğŸ“… é€‰æ‹©æ˜ŸæœŸ" description="ç‚¹å‡»é€‰æ‹©è¦æ‰§è¡Œçš„æ˜ŸæœŸ">
                                <div class="weekday-selector">
                                    <div class="weekday-option" data-day="1" onclick="toggleWeekDay(1)">
                                        <input type="checkbox" id="weekDay1" name="weekDay1" style="display:none;"/>
                                        å‘¨ä¸€
                                    </div>
                                    <div class="weekday-option" data-day="2" onclick="toggleWeekDay(2)">
                                        <input type="checkbox" id="weekDay2" name="weekDay2" style="display:none;"/>
                                        å‘¨äºŒ
                                    </div>
                                    <div class="weekday-option" data-day="3" onclick="toggleWeekDay(3)">
                                        <input type="checkbox" id="weekDay3" name="weekDay3" style="display:none;"/>
                                        å‘¨ä¸‰
                                    </div>
                                    <div class="weekday-option" data-day="4" onclick="toggleWeekDay(4)">
                                        <input type="checkbox" id="weekDay4" name="weekDay4" style="display:none;"/>
                                        å‘¨å››
                                    </div>
                                    <div class="weekday-option" data-day="5" onclick="toggleWeekDay(5)">
                                        <input type="checkbox" id="weekDay5" name="weekDay5" style="display:none;"/>
                                        å‘¨äº”
                                    </div>
                                    <div class="weekday-option" data-day="6" onclick="toggleWeekDay(6)">
                                        <input type="checkbox" id="weekDay6" name="weekDay6" style="display:none;"/>
                                        å‘¨å…­
                                    </div>
                                    <div class="weekday-option" data-day="7" onclick="toggleWeekDay(7)">
                                        <input type="checkbox" id="weekDay7" name="weekDay7" style="display:none;"/>
                                        å‘¨æ—¥
                                    </div>
                                </div>
                            </f:entry>
                            
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´" description="é€‰æ‹©æ¯å‘¨æ‰§è¡Œçš„æ—¶é—´">
                                <f:textbox name="weeklyTime" 
                                          value="09:00"
                                          placeholder="ä¾‹å¦‚: 09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- æ¯æœˆé…ç½® -->
                        <div id="schedule-monthly" class="schedule-type-content">
                            <f:entry title="ğŸ“† é€‰æ‹©æ—¥æœŸ" description="è¾“å…¥è¦æ‰§è¡Œçš„æ—¥æœŸï¼Œå¤šä¸ªæ—¥æœŸç”¨é€—å·åˆ†éš”ï¼ˆä¾‹å¦‚: 1,15,28ï¼‰">
                                <f:textbox name="monthDays" 
                                          value="1"
                                          placeholder="ä¾‹å¦‚: 1,15,28"/>
                            </f:entry>
                            
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´" description="é€‰æ‹©æ¯æœˆæ‰§è¡Œçš„æ—¶é—´">
                                <f:textbox name="monthlyTime" 
                                          value="09:00"
                                          placeholder="ä¾‹å¦‚: 09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- é€šç”¨é…ç½® -->
                        <f:entry title="ğŸ“„ æè¿°" description="ä¸ºè¿™ä¸ªå‘¨æœŸæ€§è§„åˆ™æ·»åŠ è¯´æ˜">
                            <f:textbox name="recurringDescription" 
                                      value=""
                                      placeholder="è§„åˆ™è¯´æ˜ï¼ˆå¯é€‰ï¼‰"/>
                        </f:entry>
                        
                        <!-- å‚æ•° -->
                        <j:if test="${!it.jobParameters.isEmpty()}">
                            <f:section title="ğŸ”§ æ„å»ºå‚æ•°">
                                <j:forEach var="param" items="${it.jobParameters}">
                                    <f:entry title="${param.name}" description="${param.description}">
                                        <j:choose>
                                            <j:when test="${param.class.simpleName == 'BooleanParameterDefinition'}">
                                                <f:checkbox name="recurring_param_${param.name}" 
                                                           checked="${param.defaultParameterValue.value}"
                                                           value="true"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'ChoiceParameterDefinition'}">
                                                <f:select name="recurring_param_${param.name}">
                                                    <j:forEach var="choice" items="${param.choices}">
                                                        <f:option value="${choice}" selected="${choice == param.defaultParameterValue.value}">${choice}</f:option>
                                                    </j:forEach>
                                                </f:select>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'TextParameterDefinition'}">
                                                <f:textarea name="recurring_param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"
                                                           rows="3"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'PasswordParameterDefinition'}">
                                                <f:password name="recurring_param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"/>
                                            </j:when>
                                            <j:otherwise>
                                                <f:textbox name="recurring_param_${param.name}" 
                                                          value="${param.defaultParameterValue.value}"/>
                                            </j:otherwise>
                                        </j:choose>
                                    </f:entry>
                                </j:forEach>
                            </f:section>
                        </j:if>
                        
                        <f:block>
                            <f:submit value="âœ“ æ·»åŠ å‘¨æœŸæ€§è§„åˆ™" class="btn-primary"/>
                        </f:block>
                    </f:form>
                </div>

            <!-- å‘¨æœŸæ€§è§„åˆ™åˆ—è¡¨ -->
                <div class="schedule-list-card">
                    <h2>
                        ğŸ”„ å‘¨æœŸæ€§è§„åˆ™
                        <span class="schedule-count">${it.recurringRules.size()}</span>
                    </h2>
            <j:choose>
                <j:when test="${it.recurringRules.isEmpty()}">
                            <div class="no-data">
                                ğŸ“­ æš‚æ— å‘¨æœŸæ€§è§„åˆ™
                            </div>
                </j:when>
                <j:otherwise>
                            <j:forEach var="rule" items="${it.recurringRules}">
                                <div class="rule-card ${rule.enabled ? '' : 'disabled'}">
                                    <div class="rule-header">
                                        <div class="rule-title">
                                            <j:if test="${rule.enabled}">
                                                âœ… 
                                            </j:if>
                                            <j:if test="${!rule.enabled}">
                                                â¸ï¸ 
                                            </j:if>
                                            ${rule.scheduleDescription}
                                        </div>
                                        <div class="rule-actions">
                                                <button type="button" class="btn-edit" 
                                                        data-rule-id="${rule.id}"
                                                        data-schedule-type="${rule.scheduleType}"
                                                        data-description="${rule.description}"
                                                        data-parameters="${rule.parametersString}"
                                                        onclick="editRecurringRule(this)" 
                                                        title="ç¼–è¾‘">
                                                    âœï¸ ç¼–è¾‘
                                                </button>
                                            <j:if test="${rule.enabled}">
                                                <form method="post" action="toggleRecurringRule" style="display: inline;">
                                                    <input type="hidden" name="ruleId" value="${rule.id}"/>
                                                    <input type="hidden" name="enabled" value="false"/>
                                                    <button type="submit" class="btn-secondary" title="ç¦ç”¨">
                                                        â¸ï¸ ç¦ç”¨
                                                    </button>
                                                </form>
                                            </j:if>
                                            <j:if test="${!rule.enabled}">
                                                <form method="post" action="toggleRecurringRule" style="display: inline;">
                                                    <input type="hidden" name="ruleId" value="${rule.id}"/>
                                                    <input type="hidden" name="enabled" value="true"/>
                                                    <button type="submit" class="btn-secondary" title="å¯ç”¨">
                                                        â–¶ï¸ å¯ç”¨
                                                    </button>
                                                </form>
                                            </j:if>
                                            <form method="post" action="deleteRecurringRule" style="display: inline;">
                                                <input type="hidden" name="ruleId" value="${rule.id}"/>
                                                <button type="submit" class="btn-danger" title="åˆ é™¤">
                                                    ğŸ—‘ï¸ åˆ é™¤
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <j:if test="${rule.description != null and rule.description != ''}">
                                        <div style="color: #666; margin-bottom: 8px;">
                                            ${rule.description}
                                        </div>
                                    </j:if>
                                    <div class="param-display">
                                        ${rule.parametersString}
                                    </div>
                                </div>
                            </j:forEach>
                </j:otherwise>
            </j:choose>
                </div>

            <!-- å¾…æ‰§è¡Œçš„é¢„çº¦ -->
                <div class="schedule-list-card">
                    <h2>
                        ğŸš€ å¾…æ‰§è¡Œçš„é¢„çº¦
                        <span class="schedule-count">${it.pendingBuilds.size()}</span>
                    </h2>
            <j:choose>
                <j:when test="${it.pendingBuilds.isEmpty()}">
                            <div class="no-data">
                                ğŸ“­ æš‚æ— å¾…æ‰§è¡Œçš„é¢„çº¦
                            </div>
                </j:when>
                <j:otherwise>
                    <table class="sortable pane bigtable" style="width: 100%; margin-top: 10px;">
                        <thead>
                            <tr>
                                        <th style="width: 180px;">é¢„çº¦æ—¶é—´</th>
                                        <th style="width: 150px;">â±ï¸ å€’è®¡æ—¶</th>
                                <th>æè¿°</th>
                                        <th style="width: 200px;">å‚æ•°</th>
                                        <th style="width: 100px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <j:forEach var="task" items="${it.pendingBuilds}">
                                <tr>
                                    <td>${it.formatDateTime(task.scheduledTime)}</td>
                                            <td>
                                                <span class="countdown" data-target="${task.scheduledTime}">
                                                    ${it.getRelativeTime(task.scheduledTime)}
                                                </span>
                                            </td>
                                    <td>${task.description}</td>
                                            <td>
                                                <div class="param-display">
                                        ${task.parametersString}
                                                </div>
                                    </td>
                                    <td>
                                                <button type="button" class="btn-edit" 
                                                        data-task-id="${task.id}"
                                                        data-scheduled-time="${task.scheduledTime}"
                                                        data-description="${task.description}"
                                                        data-parameters="${task.parametersString}"
                                                        onclick="editScheduledBuild(this)">
                                                    âœï¸ ç¼–è¾‘
                                                </button>
                                        <form method="post" action="cancel" style="display: inline;">
                                            <input type="hidden" name="taskId" value="${task.id}"/>
                                                    <button type="submit" class="btn-danger">
                                                        âœ— å–æ¶ˆ
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </j:forEach>
                        </tbody>
                    </table>
                </j:otherwise>
            </j:choose>
                </div>

            <!-- æ‰€æœ‰é¢„çº¦å†å² -->
                <div class="schedule-list-card">
                    <h2>
                        ğŸ“š æ‰€æœ‰é¢„çº¦è®°å½•
                        <span class="schedule-count">${it.scheduledBuilds.size()}</span>
                    </h2>
            <j:choose>
                <j:when test="${it.scheduledBuilds.isEmpty()}">
                            <div class="no-data">
                                ğŸ“­ æš‚æ— é¢„çº¦è®°å½•
                            </div>
                </j:when>
                <j:otherwise>
                    <table class="sortable pane bigtable" style="width: 100%; margin-top: 10px;">
                        <thead>
                            <tr>
                                        <th style="width: 180px;">é¢„çº¦æ—¶é—´</th>
                                        <th style="width: 120px;">çŠ¶æ€</th>
                                <th>æè¿°</th>
                                        <th style="width: 200px;">å‚æ•°</th>
                                        <th style="width: 140px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <j:forEach var="task" items="${it.scheduledBuilds}">
                                <tr>
                                    <td>${it.formatDateTime(task.scheduledTime)}</td>
                                    <td>
                                        <j:choose>
                                            <j:when test="${task.executed}">
                                                        <span class="status-badge status-executed">âœ“ å·²æ‰§è¡Œ</span>
                                            </j:when>
                                            <j:when test="${task.cancelled}">
                                                        <span class="status-badge status-cancelled">âœ— å·²å–æ¶ˆ</span>
                                            </j:when>
                                            <j:when test="${task.pending}">
                                                        <span class="status-badge status-pending">â³ å¾…æ‰§è¡Œ</span>
                                            </j:when>
                                            <j:otherwise>
                                                        <span class="status-badge status-expired">âš  å·²è¿‡æœŸ</span>
                                            </j:otherwise>
                                        </j:choose>
                                    </td>
                                    <td>${task.description}</td>
                                            <td>
                                                <div class="param-display">
                                        ${task.parametersString}
                                                </div>
                                    </td>
                                    <td>
                                        <j:if test="${task.pending}">
                                            <form method="post" action="cancel" style="display: inline; margin-right: 5px;">
                                                <input type="hidden" name="taskId" value="${task.id}"/>
                                                        <button type="submit" class="btn-danger">
                                                            âœ— å–æ¶ˆ
                                                </button>
                                            </form>
                                        </j:if>
                                        <form method="post" action="delete" style="display: inline;">
                                            <input type="hidden" name="taskId" value="${task.id}"/>
                                                    <button type="submit" class="btn-secondary">
                                                        ğŸ—‘ï¸ åˆ é™¤
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </j:forEach>
                        </tbody>
                    </table>
                </j:otherwise>
            </j:choose>
                </div>
            </div>
            
            <!-- ç¼–è¾‘é¢„çº¦æ¨¡æ€æ¡† -->
            <div id="editModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>âœï¸ ç¼–è¾‘é¢„çº¦æ„å»º</h2>
                        <span class="close" onclick="closeEditModal()">Ã—</span>
                    </div>
                    
                    <f:form method="post" action="update">
                        <input type="hidden" id="editTaskId" name="taskId" value=""/>
                        
                        <f:entry title="ğŸ“… é¢„çº¦æ—¶é—´" description="é€‰æ‹©æ–°çš„æ„å»ºæ‰§è¡Œæ—¶é—´">
                            <input type="datetime-local" id="editScheduledTime" name="scheduledTime" 
                                   required="required"
                                   style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"/>
                        </f:entry>
                        
                        <f:entry title="ğŸ“„ æè¿°" description="æ›´æ–°é¢„çº¦è¯´æ˜">
                            <f:textbox id="editDescription" name="description" 
                                       placeholder="é¢„çº¦è¯´æ˜ï¼ˆå¯é€‰ï¼‰"/>
                        </f:entry>
                        
                        <!-- å‚æ•° -->
                        <j:if test="${!it.jobParameters.isEmpty()}">
                            <div id="editParametersSection">
                                <f:section title="ğŸ”§ æ„å»ºå‚æ•°">
                                    <j:forEach var="param" items="${it.jobParameters}">
                                        <f:entry title="${param.name}" description="${param.description}">
                                            <j:choose>
                                                <j:when test="${param.class.simpleName == 'BooleanParameterDefinition'}">
                                                    <f:checkbox name="param_${param.name}" 
                                                               checked="${param.defaultParameterValue.value}"
                                                               value="true"/>
                                                </j:when>
                                                <j:when test="${param.class.simpleName == 'ChoiceParameterDefinition'}">
                                                    <f:select name="param_${param.name}">
                                                        <j:forEach var="choice" items="${param.choices}">
                                                            <f:option value="${choice}" selected="${choice == param.defaultParameterValue.value}">${choice}</f:option>
                                                        </j:forEach>
                                                    </f:select>
                                                </j:when>
                                                <j:when test="${param.class.simpleName == 'TextParameterDefinition'}">
                                                    <f:textarea name="param_${param.name}" 
                                                               value="${param.defaultParameterValue.value}"
                                                               rows="3"/>
                                                </j:when>
                                                <j:when test="${param.class.simpleName == 'PasswordParameterDefinition'}">
                                                    <f:password name="param_${param.name}" 
                                                               value="${param.defaultParameterValue.value}"/>
                                                </j:when>
                                                <j:otherwise>
                                                    <f:textbox name="param_${param.name}" 
                                                              value="${param.defaultParameterValue.value}"/>
                                                </j:otherwise>
                                            </j:choose>
                                        </f:entry>
                                    </j:forEach>
                                </f:section>
                            </div>
                        </j:if>
                        
                        <f:block>
                            <f:submit value="âœ“ æ›´æ–°é¢„çº¦" class="btn-primary"/>
                            <button type="button" class="btn-secondary" onclick="closeEditModal()" 
                                    style="margin-left: 10px;">å–æ¶ˆ</button>
                        </f:block>
                    </f:form>
                </div>
            </div>
            
            <!-- ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™æ¨¡æ€æ¡† -->
            <div id="editRecurringModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>âœï¸ ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™</h2>
                        <span class="close" onclick="closeEditRecurringModal()">Ã—</span>
                    </div>
                    
                    <f:form method="post" action="updateRecurringRule">
                        <input type="hidden" id="editRuleId" name="ruleId" value=""/>
                        <input type="hidden" id="editScheduleTypeInput" name="scheduleType" value="DAILY"/>
                        
                        <!-- è°ƒåº¦ç±»å‹é€‰æ‹©å™¨ -->
                        <div class="schedule-type-selector">
                            <div class="edit-schedule-type-option active" data-type="DAILY" onclick="switchEditScheduleType('DAILY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“…</div>
                                <div style="font-weight: 600;">æ¯å¤©</div>
                            </div>
                            <div class="edit-schedule-type-option" data-type="WEEKLY" onclick="switchEditScheduleType('WEEKLY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“†</div>
                                <div style="font-weight: 600;">æ¯å‘¨</div>
                            </div>
                            <div class="edit-schedule-type-option" data-type="MONTHLY" onclick="switchEditScheduleType('MONTHLY')">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ—“ï¸</div>
                                <div style="font-weight: 600;">æ¯æœˆ</div>
                            </div>
                        </div>
                        
                        <!-- æ¯å¤©é…ç½® -->
                        <div id="edit-schedule-daily" class="edit-schedule-type-content active">
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´">
                                <f:textbox name="dailyTime" value="09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- æ¯å‘¨é…ç½® -->
                        <div id="edit-schedule-weekly" class="edit-schedule-type-content">
                            <f:entry title="ğŸ“… é€‰æ‹©æ˜ŸæœŸ">
                                <div class="weekday-selector">
                                    <div class="weekday-option" data-day="1" onclick="toggleWeekDay(1)">
                                        <input type="checkbox" id="weekDay1" name="weekDay1" style="display:none;"/>
                                        å‘¨ä¸€
                                    </div>
                                    <div class="weekday-option" data-day="2" onclick="toggleWeekDay(2)">
                                        <input type="checkbox" id="weekDay2" name="weekDay2" style="display:none;"/>
                                        å‘¨äºŒ
                                    </div>
                                    <div class="weekday-option" data-day="3" onclick="toggleWeekDay(3)">
                                        <input type="checkbox" id="weekDay3" name="weekDay3" style="display:none;"/>
                                        å‘¨ä¸‰
                                    </div>
                                    <div class="weekday-option" data-day="4" onclick="toggleWeekDay(4)">
                                        <input type="checkbox" id="weekDay4" name="weekDay4" style="display:none;"/>
                                        å‘¨å››
                                    </div>
                                    <div class="weekday-option" data-day="5" onclick="toggleWeekDay(5)">
                                        <input type="checkbox" id="weekDay5" name="weekDay5" style="display:none;"/>
                                        å‘¨äº”
                                    </div>
                                    <div class="weekday-option" data-day="6" onclick="toggleWeekDay(6)">
                                        <input type="checkbox" id="weekDay6" name="weekDay6" style="display:none;"/>
                                        å‘¨å…­
                                    </div>
                                    <div class="weekday-option" data-day="7" onclick="toggleWeekDay(7)">
                                        <input type="checkbox" id="weekDay7" name="weekDay7" style="display:none;"/>
                                        å‘¨æ—¥
                                    </div>
                                </div>
                            </f:entry>
                            
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´">
                                <f:textbox name="weeklyTime" value="09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- æ¯æœˆé…ç½® -->
                        <div id="edit-schedule-monthly" class="edit-schedule-type-content">
                            <f:entry title="ğŸ“† é€‰æ‹©æ—¥æœŸ">
                                <f:textbox name="monthDays" value="1"/>
                            </f:entry>
                            
                            <f:entry title="â° æ‰§è¡Œæ—¶é—´">
                                <f:textbox name="monthlyTime" value="09:00"/>
                            </f:entry>
                        </div>
                        
                        <!-- é€šç”¨é…ç½® -->
                        <f:entry title="ğŸ“„ æè¿°">
                            <f:textbox id="editRuleDescription" name="recurringDescription" value=""/>
                        </f:entry>
                        
                        <!-- å‚æ•° -->
                        <j:if test="${!it.jobParameters.isEmpty()}">
                            <f:section title="ğŸ”§ æ„å»ºå‚æ•°">
                                <j:forEach var="param" items="${it.jobParameters}">
                                    <f:entry title="${param.name}" description="${param.description}">
                                        <j:choose>
                                            <j:when test="${param.class.simpleName == 'BooleanParameterDefinition'}">
                                                <f:checkbox name="recurring_param_${param.name}" 
                                                           checked="${param.defaultParameterValue.value}"
                                                           value="true"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'ChoiceParameterDefinition'}">
                                                <f:select name="recurring_param_${param.name}">
                                                    <j:forEach var="choice" items="${param.choices}">
                                                        <f:option value="${choice}">${choice}</f:option>
                                                    </j:forEach>
                                                </f:select>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'TextParameterDefinition'}">
                                                <f:textarea name="recurring_param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"
                                                           rows="3"/>
                                            </j:when>
                                            <j:when test="${param.class.simpleName == 'PasswordParameterDefinition'}">
                                                <f:password name="recurring_param_${param.name}" 
                                                           value="${param.defaultParameterValue.value}"/>
                                            </j:when>
                                            <j:otherwise>
                                                <f:textbox name="recurring_param_${param.name}" 
                                                          value="${param.defaultParameterValue.value}"/>
                                            </j:otherwise>
                                        </j:choose>
                                    </f:entry>
                                </j:forEach>
                            </f:section>
                        </j:if>
                        
                        <f:block>
                            <f:submit value="âœ“ æ›´æ–°è§„åˆ™" class="btn-primary"/>
                            <button type="button" class="btn-secondary" onclick="closeEditRecurringModal()" 
                                    style="margin-left: 10px;">å–æ¶ˆ</button>
                        </f:block>
                    </f:form>
                </div>
            </div>
        </l:main-panel>
    </l:layout>
</j:jelly>



